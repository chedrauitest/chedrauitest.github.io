<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalle del Producto</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header>
        <h1>Mi Tienda</h1>
        <div class="cart-container" onclick="window.location.href='carrito.html'">
            <svg class="cart-icon" viewBox="0 0 24 24">
                <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
            </svg>
            <span id="cart-count" class="cart-badge">0</span>
        </div>
    </header>

    <div class="container">
        <button onclick="window.history.back()" style="background:#7f8c8d; margin-bottom:20px;">&larr; Volver</button>
        <div id="detalle-container" class="detail-view">
            <p>Cargando...</p>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // Lógica de renderizado (se mantiene igual)
        const params = new URLSearchParams(window.location.search);
        const idProducto = params.get('id');
        const contenedor = document.getElementById('detalle-container');
        if (typeof PRODUCTOS !== 'undefined') {
            const producto = PRODUCTOS.find(p => p.id == idProducto);
            if (producto) {
                contenedor.innerHTML = `
                    <img src="${producto.imagen}" class="detail-img">
                    <h2>${producto.nombre}</h2>
                    <p>${producto.desc}</p>
                    <h3 style="color: #27ae60;">${producto.precio}</h3>
                    <hr>
                    <button onclick="Carrito.agregar(${producto.id})">Agregar al Carrito</button>
                `;
            }
        }
    </script>

    <script type="text/javascript">
        // 1. Definimos la configuración ANTES de cargar el script
        window.Intercept = { 
            apiKey: '9019d3a4-1104-4f00-b42e-49f9176f0c18' 
        };

        // 2. Cargamos el script de QuestionPro de forma normal
        (function() {
            var scriptQP = document.createElement('script');
            scriptQP.type = 'text/javascript';
            scriptQP.async = true;
            scriptQP.src = "https://intercept-widget.questionpro.eu/static/js/loader.js";
            document.head.appendChild(scriptQP);
        })();

        // 3. LA CLAVE: Bloqueamos que QuestionPro escuche los clics en el body
        // Esto evita que al cerrar el popup y dar clic, se vuelva a abrir.
        document.addEventListener('click', function(event) {
            // Si el clic NO es dentro del popup de QuestionPro, detenemos la propagación
            // para que el script de QP no se entere de que hiciste clic.
            const esPopup = event.target.closest('.qpro-intercept-container') || 
                            event.target.closest('[id*="qpro"]');
            
            if (!esPopup) {
                event.stopPropagation();
            }
        }, true); // El 'true' es vital: captura el evento antes que nadie
    </script>

</body>
</html>
